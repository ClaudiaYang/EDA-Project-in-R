---
title: "EDA Code Notebook Draft"
author: "Group 5"
date: "2024-10-03"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(maps)
library(scales)
```

## Introduction

This dataset focuses on school performances scores across various U.S. states from 2005 to 2015. This dataset provides us with potential insights on understanding the educational landscape in the United States. It includes some interesting variables such as graduation rates, test scores, teacher statistics, student-teacher ratios, gender ratios, family income and many other factors that could impact the school performance (measured by GPA).

This analysis is motivated by a need to investigate the disparities and inequalities in educational outcomes across different regions and demographics. Through exploring the potential relationships between variables mentioned above, we want to discover some pattern that might highlight areas in need of education policy intervention. By evaluating the extent to which these resources correlate with studentsâ€™ academic success, the educational stakeholders could also gain some data-driven insights for improving public education. 

We chose this dataset because we are fully aware that education is the foundation of personal and societal progress as college students. Many of the issues college students face, like unequal access to quality education, educational funding, and achievement gaps, begin in the K-12 system. This dataset also fits into our academic interests. Because it offers a unique opportunity to combine our data analytical skills and interest in social sciences. 

```{r}
#Load the dataset
score<-read.csv("data/school_scores.csv")
```

```{r}
#Inspect the dataset
head(score)
```

## Data Cleaning/Simplifying

It is shown that there are 99 variables total in this dataset, which is too many for our analysis. After careful examination of the dataset, we decided to subset the dataset with the variables we think that are useful for our analysis. 
```{r}
# Subset the dataset with relevant variables 
demographic_vars <- c("Year", "State.Code", "State.Name")
test_score_vars <- c("Total.Math", "Total.Test.takers", "Total.Verbal", 
                     "Gender.Female.Math", "Gender.Female.Test.takers" , "Gender.Female.Verbal",
                     "Gender.Male.Math", "Gender.Male.Test.takers","Gender.Male.Verbal")
academic_vars <- c("Academic.Subjects.Arts.Music.Average.GPA", 
                   "Academic.Subjects.English.Average.GPA",
                   "Academic.Subjects.Mathematics.Average.GPA", 
                   "Academic.Subjects.Natural.Sciences.Average.Years")
income_vars <- grep("Family.Income", colnames(score), value = TRUE)
gpa_vars <- grep("GPA", colnames(score), value = TRUE)
```

```{r}
# Combine all selected variables into one vector
selected_vars <- c(demographic_vars, test_score_vars, academic_vars, income_vars, gpa_vars)
```

```{r}
# Subset the dataset
score_subset <- score %>%
  select(all_of(selected_vars))
```

```{r}
# Check the structure of the new subset
str(score_subset)
head(score_subset)
```

```{r}
#Summary Statistics of the dataset
summary(score_subset)
```


```{r}
#save the new subset to a file
write_csv(score_subset, "data/school_scores_subset.csv")
```

By the code above, we reduced the variables from 99 to 58, leaving the ones we think are potentially insightful only. 


## Part I: Describing and Breaking down Variables

In the dataset subseting section, we have catgetorized the 58 variables into four themes. We would now explore the four themes separately. 

### Theme 1: Demographic information

The dataset contains basic demographic information that helps identify the year and the state in which the data was collected. These variables include:

Year: The year the data was recorded.
State.Code: Numeric or alphabetical codes assigned to states.
State.Name: The full names of the states.

```{r}
demographic_data <- score_subset[, demographic_vars]
print(demographic_data)
```

### Theme 2: Test Scores

Test scores represent one of the core components of our dataset. These variables include overall test scores, family income group test scores, and test scores based on GPA. Here are the main variables:

Overall Test Scores: Total.Math, Total.Test.takers, Total.Verbal
Family Income Brackets: Family.Income.Between.20.40k.Math, Family.Income.More.than.100k.Verbal
GPA Test Scores: GPA.A.Math, GPA.C.Verbal, GPA.No.response.Math
Gender-based Test Scores: Gender.Female.Math, Gender.Male.Verbal
Score Ranges: These show performance in specific score ranges, such as Score.Ranges.Between.300.to.400.Math.Total.

```{r}
test_score_data <- score_subset[, test_score_vars]
print(test_score_data)
```

### Theme 3: Academic Performance in Subjects

Our dataset also provides information on GPA and the number of years spent studying different subjects. The subjects include arts, English, foreign languages, mathematics, and natural sciences. Each subject has two variables:

Average GPA: For example, Academic.Subjects.English.Average.GPA.
Average Years of Study: For example, Academic.Subjects.English.Average.Years.
R Code to display Academic Performance Variables

```{r}
academic_data <- score_subset[, academic_vars]
print(academic_data)
```

### Theme 4. Family Income Groups

Family income groups are crucial in understanding how socioeconomic factors influence student performance. Our dataset includes variables for different income brackets and their corresponding test scores:

Family.Income.Between.20.40k.Math
Family.Income.More.than.100k.Verbal
Family.Income.Less.than.20k.Test.takers

```{r}
income_data <- score_subset[, income_vars]
print(income_data)
```

### Theme 5: GPA-based Breakdown

Our dataset provides a breakdown of test scores based on GPA ranges. Students are categorized into groups based on their GPA, ranging from A+ to D or lower. This allows for analysis of how students in different GPA ranges perform on standardized tests:

GPA.A.Math
GPA.B.Verbal
GPA.D.or.lower.Math

```{r}
gpa_data <- score_subset[, gpa_vars]
print(gpa_data)
```


## Part II: Some Simple Analysis and Visualizations

### Average Math & Verbal Scores vs. GPA Analysis

- We calculated the mean math score for each GPA category and plotted it in a bar plot. This visualization shows how math scores are distributed across GPA categories, with each bar representing the average math score for a specific GPA range (from "A+" to "D or lower"). 

```{r}
gpa_math_data <- data.frame(
  GPA = c("A+", "A", "A-", "B", "C", "D or lower"),
  Math_Scores = c(mean(score_subset$GPA.A.plus.Math, na.rm = TRUE), 
                  mean(score_subset$GPA.A.Math, na.rm = TRUE), 
                  mean(score_subset$GPA.A.minus.Math, na.rm = TRUE),
                  mean(score_subset$GPA.B.Math, na.rm = TRUE),
                  mean(score_subset$GPA.C.Math, na.rm = TRUE),
                  mean(score_subset$GPA.D.or.lower.Math, na.rm = TRUE))
)

barplot(gpa_math_data$Math_Scores, 
        names.arg = gpa_math_data$GPA, 
        main = "Average Math Scores by GPA Category", 
        xlab = "GPA Category", 
        ylab = "Math Scores",
        col = "lightblue")
```

We can observe a decreasing trend in the plot, indicating an association between GPA and math scores. 
The students with an "A+" GPA have the highest average math scores, while those in the "D or lower" category have the lowest. This suggests that students with higher GPAs tend to perform better in SAT math, and there's a consistent drop in math scores as GPA decreases. 

- We calculated the mean verbal score for each GPA category and plotted it in a bar plot. This visualization shows how verbal scores are distributed across GPA categories, with each bar representing the average verbal score for a specific GPA range (from "A+" to "D or lower").

```{r}
#Average verbal scores across different GPA categories
gpa_verbal_data <- data.frame(
  GPA = c("A+", "A", "A-", "B", "C", "D or lower"),
  Verbal_Scores = c(mean(score_subset$GPA.A.plus.Verbal, na.rm = TRUE), 
                    mean(score_subset$GPA.A.Verbal, na.rm = TRUE), 
                    mean(score_subset$GPA.A.minus.Verbal, na.rm = TRUE),
                    mean(score_subset$GPA.B.Verbal, na.rm = TRUE),
                    mean(score_subset$GPA.C.Verbal, na.rm = TRUE),
                    mean(score_subset$GPA.D.or.lower.Verbal, na.rm = TRUE))
)

barplot(gpa_verbal_data$Verbal_Scores, 
        names.arg = gpa_verbal_data$GPA, 
        main = "Average Verbal Scores by GPA Category", 
        xlab = "GPA Category", 
        ylab = "Verbal Scores", 
        col = "lightblue")


```

From this figure, we can observe a decreasing trend in average verbal scores as GPA decreases, suggesting a positive correlation between GPA and verbal performance.  Students with an "A+" GPA have the highest average verbal scores, while those in the "D or lower" category have the lowest.  This indicates that students with higher GPAs tend to perform better in verbal assessments, and there is a consistent decline in scores as the GPA drops.

### Family Income Group Analysis

- We get the number of test takers in each family income group, such as those earning less than 20k or more than 100k, excluding missing values. We then draw a pie chart to visualize the distribution of test takers across these income groups, helping to illustrate how the number of test takers varies by family income.

```{r}
income_takers <- c(sum(score_subset$Family.Income.Less.than.20k.Test.takers, na.rm = TRUE),                    sum(score_subset$Family.Income.Between.20.40k.Test.takers, na.rm = TRUE),                    sum(score_subset$Family.Income.Between.40.60k.Test.takers, na.rm = TRUE),                    sum(score_subset$Family.Income.More.than.100k.Test.takers, na.rm = TRUE))  
income_labels <- c("Less than 20k", "Between 20-40k", "Between 40-60k", "More than 100k")  
# Calculate the total number of test takers
total_takers <- sum(income_takers)

# Calculate the percentage for each income group
income_percentages <- round(income_takers / total_takers * 100, 1)

# Create labels that include both income group and percentage
income_labels <- paste(income_labels, income_percentages, "%")

# Create the pie chart with percentages
pie(income_takers, labels = income_labels, 
    main = "Test Takers by Family Income Group")
```

The pie chart shows that the distribution of test takers across income groups is fairly balanced, but the "More than 100k" group occupies the largest portion. 

- We first extracts math scores for different family income groups, creating a new dataset called income_math_data. And we use a boxplot to visualize the distribution of math scores by income bracket, with each group assigned a different color. 

```{r}
income_math_data <- score_subset[, c("Family.Income.Less.than.20k.Math", 
                              "Family.Income.Between.20.40k.Math",
                              "Family.Income.Between.40.60k.Math",
                              "Family.Income.More.than.100k.Math")]

colnames(income_math_data) <- c("<20k", "20-40k", "40-60k", ">100k")

boxplot(income_math_data, 
        main = "Distribution of Math Scores by Family Income Bracket", 
        xlab = "Family Income Bracket", 
        ylab = "Math Scores", 
        col = c("lightgreen", "lightblue", "lightcoral", "lightgoldenrod"))
```

The boxplot shows that the median math scores are similar across all income groups, with a slight increasing trend as income rises. However, the <20k income group has the widest range of scores, including several low outliers. The >100k group has more high-performing students, with fewer outliers at the low end. The middle-income groups, 20-40k and 40-60k, show less variability, with most scores tightly clustered. 

### Total Scores Analysis

- We plotted a histogram of total math and verbal scores to understand the distribution of scores across the sample. The histogram shows how frequently different score ranges occur.

```{r}

par(mfrow = c(1, 2))

# Plot histogram for Total Math Scores
hist(score_subset$Total.Math,
     breaks = 20,
     main = "Histogram of Total Math Scores",
     xlab = "Math Scores",
     col = "lightcoral",
     border = "black")

# Plot histogram for Total Verbal Scores
hist(score_subset$Total.Verbal,
     breaks = 20,
     main = "Histogram of Total Verbal Scores",
     xlab = "Verbal Scores",
     col = "lightblue",
     border = "black")

par(mfrow = c(1, 1))

```

From the histograms, we can observe that both total math and verbal scores are concentrated around a central range, rather than being evenly distributed. The peak in both histograms occurs between scores of 480 and 520, indicating that most students achieved scores near this score range in both subjects; and only a small number of students scored below 450 or above 600.

To better assess whether these distributions follow a normal distribution, we will next perform a QQ plot (quantile-quantile plot) to visually check for normality. The QQ plot will allow us to see if the observed scores deviate significantly from a theoretical normal distribution.

```{r}
par(mfrow = c(1, 2))

# QQ plot for Total Math Scores
qqnorm(score_subset$Total.Math, main = "QQ Plot of Math Scores", col = "lightcoral")
qqline(score_subset$Total.Math, col = "black")

# QQ plot for Total Verbal Scores
qqnorm(score_subset$Total.Verbal, main = "QQ Plot of Verbal Scores", col = "lightblue")
qqline(score_subset$Total.Verbal, col = "black")

par(mfrow = c(1, 1))
```

We observe that both math and verbal scores show some degree of deviation from a normal distribution, especially at the extremes. However, the data mostly follows a normal pattern, with only slight non-normality, especially at the higher ends.

- We generated a scatter plot to visualize the relationship between math and verbal scores, with each point representing a student's performance in both areas. 

```{r}
plot(score_subset$Total.Math, score_subset$Total.Verbal, 
     main = "Math Scores vs. Verbal Scores", 
     xlab = "Math Scores", 
     ylab = "Verbal Scores", 
     pch = 19, 
     col = "blue",
     cex = 0.6)
```

The scatter plot shows a strong positive relationship between math and verbal scores. As math scores increase, verbal scores tend to increase as well, indicating that students who perform well in math also tend to score higher in verbal sections. 

### Gender Group Analysis

- We plotted a pie chart to represent the distribution of test takers by gender. The chart is divided into two segments, each showing the proportion of male and female participants in the test. 

```{r}
gender_takers <- c(sum(score_subset$Gender.Female.Test.takers, na.rm = TRUE),
                   sum(score_subset$Gender.Male.Test.takers, na.rm = TRUE))
gender_labels <- c("Female", "Male")
# Calculate the total number of test takers
total_takers <- sum(gender_takers)

# Calculate the percentage for each gender
gender_percentages <- round(gender_takers / total_takers * 100, 1)

# Create labels that include both gender and percentage
gender_labels <- paste(gender_labels, gender_percentages, "%")

# Create the pie chart with percentages
pie(gender_takers, labels = gender_labels, 
    main = "Test Takers by Gender", 
    col = c("pink", "lightblue"))
```

From the pie chart, we can observe that there are slightly more female test takers compared to male test takers. This difference need to be further analyzed, so we then plot another chart to analysis the score difference between "Female" and "Male".

- We calculated the mean math and verbal scores for both females and males and plot in bar graph.

```{r}
# Calculate average math and verbal scores by gender
gender_scores <- data.frame(
  Gender = c("Female", "Male"),
  Avg_Math = c(mean(score_subset$Gender.Female.Math, na.rm = TRUE),
               mean(score_subset$Gender.Male.Math, na.rm = TRUE)),
  Avg_Verbal = c(mean(score_subset$Gender.Female.Verbal, na.rm = TRUE),
                 mean(score_subset$Gender.Male.Verbal, na.rm = TRUE))
)
# Reshape the data to long format for ggplot2
gender_scores_long <- gender_scores %>%
  pivot_longer(cols = c(Avg_Math, Avg_Verbal), 
               names_to = "Score_Type", 
               values_to = "Average_Score")
# Plot using ggplot
ggplot(gender_scores_long, aes(x = Gender, y = Average_Score, fill = Score_Type)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Average Math and Verbal Scores by Gender", 
       x = "Gender", 
       y = "Average Scores") +
  scale_fill_manual(values = c("lightblue", "pink")) +
  theme_minimal()
```

The bar plot shows a comparison of average math and verbal scores by gender. We can see that males have a slightly higher average math score, while females have a slightly higher average verbal score. Although the differences between the genders in both subjects are small, it's important to statistically test whether these differences are significant. To explore this further, we will conduct a two-sample t-test to determine if the observed differences in math and verbal scores between males and females are statistically significant or simply due to chance.

```{r}
# Perform t-test for math scores
math_ttest <- t.test(score_subset$Gender.Female.Math, 
                     score_subset$Gender.Male.Math, 
                     na.rm = TRUE)

# Perform t-test for verbal scores
verbal_ttest <- t.test(score_subset$Gender.Female.Verbal, 
                       score_subset$Gender.Male.Verbal, 
                       na.rm = TRUE)

# Print the results of the t-tests
math_ttest
verbal_ttest

```

Math Scores: The p-value is smaller than 0.05, indicating a statistically significant difference between the math scores of females and males. The confidence interval does not contain 0, further supporting the conclusion that the true difference in means is significant. Males, on average, scored about 35 points higher than females in math (553.91 vs. 518.42).

Verbal Scores:The p-value (0.01266) is also smaller than 0.05, indicating a statistically significant difference between verbal scores for females and males. However, the difference is much smaller compared to math scores, with males scoring about 6.5 points higher than females on average.

### Map 

```{r}
# Summarize the total test takers by state
state_test_takers <- score_subset %>%
  group_by(State.Code) %>%
  summarise(total_takers = sum(Total.Test.takers, na.rm = TRUE))
# Get U.S. states map data
states_map <- map_data("state")
# Convert state codes to lowercase for matching
state_test_takers$region <- tolower(state.name[match(state_test_takers$State.Code, state.abb)])

# Merge test takers data with the map data
map_data_merged <- merge(states_map, state_test_takers, by = "region", all.x = TRUE)
# Plot the map showing total test takers by state
ggplot(data = map_data_merged, aes(x = long, y = lat, group = group, fill = total_takers)) +
  geom_polygon(color = "black") +
  scale_fill_continuous(name = "Total Test Takers", low = "lightblue", high = "darkblue", na.value = "grey50") +
  theme_minimal() +
  labs(title = "Total Test Takers by State") +
  theme(legend.position = "bottom")
```

